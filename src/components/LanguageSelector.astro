---
import { supportedLanguages, getTranslations, type Language } from '../i18n';

interface Props {
    currentLang: Language;
    currentPath: string;
}

const { currentLang, currentPath } = Astro.props;
const t = getTranslations(currentLang);

// Construir la URL alternativa cambiando el prefijo de idioma
function getAlternateUrl(targetLang: Language, path: string): string {
    // Remover el prefijo de idioma actual del path
    const pathWithoutLang = path.replace(/^\/(es|en|pt)/, '');
    // Agregar el nuevo prefijo de idioma
    return `/${targetLang}${pathWithoutLang}`;
}
---

<div class="language-selector">
    <label for="language-select" class="text-sm text-[#5b5f69] font-medium">
        {t.languageSelector.label}:
    </label>
    <select
        id="language-select"
        class="ml-2 px-3 py-1.5 rounded-lg border border-[#eef0f5] bg-white text-[#1c1c1e] cursor-pointer hover:border-[#8c8f98] transition-colors focus:outline-none focus:ring-2 focus:ring-[#007aff] focus:border-transparent"
        data-current-path={currentPath}
    >
        {supportedLanguages.map((lang) => (
            <option
                value={lang}
                selected={lang === currentLang}
                data-url={getAlternateUrl(lang, currentPath)}
            >
                {lang === 'es' ? t.languageSelector.spanish : lang === 'en' ? t.languageSelector.english : t.languageSelector.portuguese}
            </option>
        ))}
    </select>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const selector = document.getElementById('language-select') as HTMLSelectElement;
        if (selector) {
            selector.addEventListener('change', (e) => {
                const target = e.target as HTMLSelectElement;
                const selectedOption = target.options[target.selectedIndex];
                const url = selectedOption.getAttribute('data-url');
                if (url) {
                    window.location.href = url;
                }
            });
        }
    });
</script>

<style>
    .language-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238c8f98' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.5rem center;
        padding-right: 2rem;
    }
</style>
